<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title>Story points predictor</title>
    <link rel="icon" href="static/img/icon.png" />
    <script src="https://code.jquery.com/jquery-3.5.1.js"></script>
    <link rel="preconnect" href="https://fonts.gstatic.com">
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500&display=swap" rel="stylesheet">
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1, shrink-to-fit=no"
    />
    <link
      rel="stylesheet"
      href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css"
      integrity="sha384-Gn5384xqQ1aoWXA+058RXPxPg6fy4IWvTNh0E263XmFcJlSAwiGgFAW/dAiS6JXm"
      crossorigin="anonymous"
    />
    <script
      src="https://code.jquery.com/jquery-3.2.1.slim.min.js"
      integrity="sha384-KJ3o2DKtIkvYIK3UENzmM7KCkRr/rE9/Qpg6aAZGJwFDMVNA/GpGFF93hXpG5KkN"
      crossorigin="anonymous"
    ></script>
    <script
      src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.12.9/umd/popper.min.js"
      integrity="sha384-ApNbgh9B+Y1QKtv3Rn7W3mgPxhU9K/ScQsAP7hUibX39j7fakFPskvXusvfa0b4Q"
      crossorigin="anonymous"
    ></script>
    <script
      src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/js/bootstrap.min.js"
      integrity="sha384-JZR6Spejh4U02d8jOt6vLEHfe/JQGiRRSQQxSfFWpi1MquVdAyjUar5+76PVCmYl"
      crossorigin="anonymous"
    ></script>
    <link href="static/css/index.css" rel="stylesheet" />
    <link
      rel="stylesheet"
      href="https://cdn.datatables.net/1.10.22/css/jquery.dataTables.min.css"
    />
    <script
      type="text/javascript"
      src="https://cdn.datatables.net/v/bs4/dt-1.10.22/datatables.min.js"
    ></script>
    <link href="https://cdn.jsdelivr.net/npm/chart.js@2.9.3/dist/Chart.min.css" rel="stylesheet" />
    <script
    type="text/javascript"
    src="https://cdn.jsdelivr.net/npm/chart.js@2.9.4/dist/Chart.min.js"
    ></script>

    <script>
      $(document).ready(function () {
        let json = "{{json}}".replace(/&#39;/g, "\"")
        json = JSON.parse(json)
        var counts = {};
        json.forEach(function(x) { counts[x.prediction] = (counts[x.prediction] || 0)+1; });
        console.log(counts)
        var ctx = $('#myChart');
        var secondChart = $('#secondChart');
        var thirdChart = $('#thirdChart');
        var data = {
            labels: Object.keys(counts),
            datasets: [{
                label: "US's Sizes",
                data: Object.values(counts),
                backgroundColor: [
                    'rgba(255, 99, 132, 0.2)',
                    'rgba(54, 162, 235, 0.2)',
                    'rgba(255, 206, 86, 0.2)',
                    'rgba(75, 192, 192, 0.2)',
                    'rgba(153, 102, 255, 0.2)',
                    'rgba(255, 159, 64, 0.2)'
                ],
                borderColor: [
                    'rgba(255, 99, 132, 1)',
                    'rgba(54, 162, 235, 1)',
                    'rgba(255, 206, 86, 1)',
                    'rgba(75, 192, 192, 1)',
                    'rgba(153, 102, 255, 1)',
                    'rgba(255, 159, 64, 1)'
                ],
                borderWidth: 1
            }]
        }
        var myChart = new Chart(ctx, {
            type: 'bar',
            data: data,
            options: {
                scales: {
                    yAxes: [{
                        ticks: {
                            beginAtZero: true
                        }
                    }]
                }
            }
        });

        new Chart(secondChart, {
            data: data,
            type: 'doughnut',
        });
        
        new Chart(thirdChart, {
            data: data,
            type: 'polarArea',
        });

        $("#predictionsTable").DataTable({
          columns: [
            { data: "title" },
            { data: "description" },
            { data: "prediction" },
          ],
          buttons: [
            'copy', 'csv', 'excel', 'pdf', 'print'
          ],
          order: [0, "desc"],
          data: json,
        });
      });
    </script>
  </head>
  <body>
    <nav style="display: flex;" class="navbar navbar-light bg-light nav">
      <a class="margin-auto navbar-brand" href="#">
        <img src="static/img/icon.png" width="40" height="40" class="d-inline-block align-top" alt="">
        <strong class="text-title">Story points predictor</strong>
      </a>
      <div class="margin-auto">
        <button class="about-button"></button>
      </div>
    </nav>
 <div class="container">

      <form
        action="/sendFile"
        class="border-class"
        method="POST"
        data-toggle="validator"
        enctype=multipart/form-data
      >
        <div class="form-group">
          <input type="file" class="form-control-file" name="file" id="predictionFile" required/>
        </div>
        <button type="submit" class="btn btn-primary">Submit</button>
      </form>
      <div class="list-group">
        <table id="predictionsTable" class="display">
          <thead>
            <tr>
              <th>Title</th>
              <th>Description</th>
              <th>Prediction</th>
            </tr>
          </thead>
        </table>
      </div>
      <div>
        <h3>Graphs</h3>
        <div class="squares-div">
          <div class="flex-1"><div class="red">S</div><span><strong>Small</strong> User Story</span></div>
          <div class="flex-1"><div class="blue">M</div><span><strong>Medium</strong> User Story</span></div>
          <div class="flex-1"><div class="yellow">L</div><span><strong>Large</strong> User Story</span></div>
        </div>
        <div class="display-flex">
          <div class="flex-1">
          <canvas class="flex-1" id="myChart" width="100" height="100"></canvas>
          </div>  
          <div class="flex-1"><canvas class="flex-1" id="secondChart" width="100" height="100"></canvas></div>
          <div class="flex-1"><canvas class="flex-1" id="thirdChart" width="100" height="100"></canvas></div>
        </div>
      </div>
    </div>
  </body>
</html>
